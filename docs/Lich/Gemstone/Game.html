<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Lich::Gemstone::Game
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Lich::Gemstone::Game";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (G)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Gemstone.html" title="Lich::Gemstone (module)">Gemstone</a></span></span>
     &raquo; 
    <span class="title">Game</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Lich::Gemstone::Game
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/games.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="socket-classvariable" class="">@@socket =
          
        </dt>
        <dd><pre class="code"><span class='kw'>nil</span></pre></dd>
      
        <dt id="mutex-classvariable" class="">@@mutex =
          
        </dt>
        <dd><pre class="code"><span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span></pre></dd>
      
        <dt id="last_recv-classvariable" class="">@@last_recv =
          
        </dt>
        <dd><pre class="code"><span class='kw'>nil</span></pre></dd>
      
        <dt id="thread-classvariable" class="">@@thread =
          
        </dt>
        <dd><pre class="code"><span class='kw'>nil</span></pre></dd>
      
        <dt id="buffer-classvariable" class="">@@buffer =
          
        </dt>
        <dd><pre class="code"><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common/SharedBuffer.html" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Common/SharedBuffer.html#initialize-instance_method" title="Lich::Common::SharedBuffer#initialize (method)">new</a></span></span></pre></dd>
      
        <dt id="_buffer-classvariable" class="">@@_buffer =
          
        </dt>
        <dd><pre class="code"><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common/SharedBuffer.html" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Common/SharedBuffer.html#initialize-instance_method" title="Lich::Common::SharedBuffer#initialize (method)">new</a></span></span></pre></dd>
      
        <dt id="autostarted-classvariable" class="">@@autostarted =
          
        </dt>
        <dd><pre class="code"><span class='kw'>false</span></pre></dd>
      
        <dt id="cli_scripts-classvariable" class="">@@cli_scripts =
          
        </dt>
        <dd><pre class="code"><span class='kw'>false</span></pre></dd>
      
        <dt id="infomon_loaded-classvariable" class="">@@infomon_loaded =
          
        </dt>
        <dd><pre class="code"><span class='kw'>false</span></pre></dd>
      
        <dt id="room_number_after_ready-classvariable" class="">@@room_number_after_ready =
          
        </dt>
        <dd><pre class="code"><span class='kw'>false</span></pre></dd>
      
        <dt id="last_id_shown_room_window-classvariable" class="">@@last_id_shown_room_window =
          
        </dt>
        <dd><pre class="code"><span class='int'>0</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_buffer-class_method" title="_buffer (class method)">.<strong>_buffer</strong>  &#x21d2; Buffer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the internal buffer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_gets-class_method" title="_gets (class method)">.<strong>_gets</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reads a line from the internal buffer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_puts-class_method" title="_puts (class method)">.<strong>_puts</strong>(str)  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sends a string to the game socket in a thread-safe manner.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#buffer-class_method" title="buffer (class method)">.<strong>buffer</strong>  &#x21d2; Buffer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the game buffer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clean_dr_serverstring-class_method" title="clean_dr_serverstring (class method)">.<strong>clean_dr_serverstring</strong>(server_string)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Cleans the server string for DragonRealms by removing superfluous tags and fixing encoding issues.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clean_gs_serverstring-class_method" title="clean_gs_serverstring (class method)">.<strong>clean_gs_serverstring</strong>(server_string)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Cleans the server string for Gemstone by replacing specific tags.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-class_method" title="close (class method)">.<strong>close</strong>  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Closes the game socket and kills the associated thread if they exist.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#closed%3F-class_method" title="closed? (class method)">.<strong>closed?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if the game socket is closed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gets-class_method" title="gets (class method)">.<strong>gets</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reads a line from the game buffer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open-class_method" title="open (class method)">.<strong>open</strong>(host, port)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Opens a connection to the game server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#puts-class_method" title="puts (class method)">.<strong>puts</strong>(str)  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sends a formatted string to the game socket and updates the last upstream message.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#thread-class_method" title="thread (class method)">.<strong>thread</strong>  &#x21d2; Thread </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the current thread associated with the Game.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="_buffer-class_method">
  
    .<strong>_buffer</strong>  &#x21d2; <tt>Buffer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the internal buffer.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Buffer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the internal buffer</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


511
512
513</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 511</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid__buffer'>_buffer</span>
  <span class='cvar'>@@_buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_gets-class_method">
  
    .<strong>_gets</strong>  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reads a line from the internal buffer.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the line read from the internal buffer</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


504
505
506</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 504</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid__gets'>_gets</span>
  <span class='cvar'>@@_buffer</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_puts-class_method">
  
    .<strong>_puts</strong>(str)  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sends a string to the game socket in a thread-safe manner.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the string to send</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


460
461
462
463
464</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 460</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid__puts'>_puts</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='cvar'>@@mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
    <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="buffer-class_method">
  
    .<strong>buffer</strong>  &#x21d2; <tt>Buffer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the game buffer.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Buffer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the game buffer</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


497
498
499</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 497</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_buffer'>buffer</span>
  <span class='cvar'>@@buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clean_dr_serverstring-class_method">
  
    .<strong>clean_dr_serverstring</strong>(server_string)  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method modifies the input string in place.</p>
</div>
  </div>


<p>Cleans the server string for DragonRealms by removing superfluous tags and fixing encoding issues.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_clean_dr_serverstring'>clean_dr_serverstring</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;&lt;popStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; &quot;&quot;</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_string</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the server string to be cleaned</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the cleaned server string</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 58</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clean_dr_serverstring'>clean_dr_serverstring</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
  <span class='comment'>## Clear out superfluous tags
</span>  <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;&lt;popStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;popStream id=\&quot;combat\&quot; /&gt;&lt;pushStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='comment'># DR occasionally has poor encoding in text, which causes parsing errors.
</span>  <span class='comment'># One example of this is in the discern text for the spell Membrach&#39;s Greed
</span>  <span class='comment'># which gets sent as Membrach\x92s Greed. This fixes the bad encoding until
</span>  <span class='comment'># Simu fixes it.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\\x92</span><span class='regexp_end'>/</span></span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Detected poorly encoded apostrophe: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x92</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Changed poorly encoded apostrophe to: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## Fix combat wrapping components - Why, DR, Why?
</span>  <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;&lt;component id=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;component id=</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='comment'># Fixes xml with \r\n in the middle of it like:
</span>  <span class='comment'># We close the first line and in the next segment, we remove the trailing bits
</span>  <span class='comment'># &lt;component id=&#39;room objs&#39;&gt;  You also see a granite altar with several candles and a water jug on it, and a granite font.\r\n
</span>  <span class='comment'># &lt;component id=&#39;room extra&#39;&gt;Placed around the interior, you see: some furniture and other bits of interest.\r\n
</span>  <span class='comment'># &lt;component id=&#39;room exits&#39;&gt;Obvious paths: clockwise, widdershins.\r\n
</span>
  <span class='comment'># Followed by in a closing line such as one of these:
</span>  <span class='comment'># &lt;/component&gt;\r\n
</span>  <span class='comment'># &lt;compass&gt;&lt;/compass&gt;&lt;/component&gt;\r\n
</span>
  <span class='comment'># If the pattern is on the left of the =~ the named capture gets assigned as a variable
</span>  <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&lt;(?&lt;xmltag&gt;dynaStream|component) id=&#39;.*&#39;&gt;[^&lt;]*(?!&lt;\/\k&lt;xmltag&gt;&gt;)\r\n$</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_server_string'>server_string</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Open-ended </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xmltag'>xmltag</span><span class='embexpr_end'>}</span><span class='tstring_content'> tag: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xmltag'>xmltag</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Open-ended </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xmltag'>xmltag</span><span class='embexpr_end'>}</span><span class='tstring_content'> tag tag fixed to: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Remove the now dangling closing tag
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(?:(\&quot;|&lt;compass&gt;&lt;\/compass&gt;))?&lt;\/(dynaStream|component)&gt;\r\n</span><span class='regexp_end'>/</span></span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Extraneous closing tag detected and deleted: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## Fix duplicate pushStrings
</span>  <span class='kw'>while</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;&lt;pushStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;&lt;pushStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@combat_count</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='ivar'>@end_combat_tags</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tag'>tag</span><span class='op'>|</span>
      <span class='comment'># server_string = &quot;&lt;!-- looking for tag: #{tag}&quot; + server_string
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_tag'>tag</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;popStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_tag'>tag</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;popStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='ivar'>@combat_count</span> <span class='op'>-=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@combat_count</span> <span class='op'>+=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;pushStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@combat_count</span> <span class='op'>-=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;popStream id=\&quot;combat\&quot; /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@combat_count</span> <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='ivar'>@combat_count</span> <span class='op'>&lt;</span> <span class='int'>0</span>

  <span class='kw'>if</span> <span class='ivar'>@atmospherics</span>
    <span class='ivar'>@atmospherics</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_prepend'>prepend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;popStream id=&quot;atmospherics&quot; /&gt;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;popStream id=&quot;atmospherics&quot; \/&gt;</span><span class='regexp_end'>/</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;pushStream id=&quot;familiar&quot; \/&gt;&lt;prompt time=&quot;[0-9]+&quot;&gt;&amp;gt;&lt;\/prompt&gt;</span><span class='regexp_end'>/</span></span> <span class='comment'># Cry For Help spell is broken...
</span>    <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;pushStream id=&quot;familiar&quot; /&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;pushStream id=&quot;atmospherics&quot; \/&gt;&lt;prompt time=&quot;[0-9]+&quot;&gt;&amp;gt;&lt;\/prompt&gt;</span><span class='regexp_end'>/</span></span> <span class='comment'># pet pigs in DragonRealms are broken...
</span>    <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;pushStream id=&quot;atmospherics&quot; /&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;pushStream id=&quot;atmospherics&quot; \/&gt;</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='ivar'>@atmospherics</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_server_string'>server_string</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clean_gs_serverstring-class_method">
  
    .<strong>clean_gs_serverstring</strong>(server_string)  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Cleans the server string for Gemstone by replacing specific tags.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_clean_gs_serverstring'>clean_gs_serverstring</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;compDef id=&#39;room text&#39;&gt;&lt;/compDef&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; &quot;&lt;compDef id=&#39;room desc&#39;&gt;...&lt;/compDef&gt;&quot;</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_string</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the server string to be cleaned</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the cleaned server string</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 38</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clean_gs_serverstring'>clean_gs_serverstring</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
  <span class='comment'># The Rift, Scatter is broken...
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;compDef id=&#39;room text&#39;&gt;&lt;\/compDef&gt;</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(.*)\s\s&lt;compDef id=&#39;room text&#39;&gt;&lt;\/compDef&gt;</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;compDef id=&#39;room desc&#39;&gt;</span><span class='embexpr_beg'>#{</span><span class='backref'>$1</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/compDef&gt;</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_server_string'>server_string</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close-class_method">
  
    .<strong>close</strong>  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Closes the game socket and kills the associated thread if they exist.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if closing the socket or killing the thread fails</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


449
450
451
452
453
454</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 449</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>if</span> <span class='cvar'>@@socket</span>
    <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
    <span class='cvar'>@@thread</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="closed?-class_method">
  
    .<strong>closed?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if the game socket is closed.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if the socket is nil or closed, false otherwise</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


437
438
439
440
441
442
443</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 437</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
  <span class='kw'>if</span> <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="gets-class_method">
  
    .<strong>gets</strong>  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reads a line from the game buffer.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the line read from the buffer</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


490
491
492</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 490</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
  <span class='cvar'>@@buffer</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open-class_method">
  
    .<strong>open</strong>(host, port)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Opens a connection to the game server.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>1234</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the hostname or IP address of the game server.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>port</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the port number to connect to the game server.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if there is an error while setting socket options or during connection.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 144</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='cvar'>@@socket</span> <span class='op'>=</span> <span class='const'>TCPSocket</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='const'>Socket</span><span class='op'>::</span><span class='const'>SOL_SOCKET</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>SO_KEEPALIVE</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'># Add check to determine if the game server hung at initial response
</span>
  <span class='cvar'>@@wrap_thread</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span>
    <span class='ivar'>@last_recv</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
    <span class='kw'>while</span> <span class='op'>!</span><span class='cvar'>@@autostarted</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@last_recv</span> <span class='op'>&lt;</span> <span class='int'>6</span><span class='rparen'>)</span>
      <span class='kw'>break</span> <span class='kw'>if</span> <span class='cvar'>@@autostarted</span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.2</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>look</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='op'>!</span><span class='cvar'>@@autostarted</span>
  <span class='rbrace'>}</span>

  <span class='cvar'>@@thread</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span>
    <span class='kw'>begin</span>
      <span class='kw'>while</span> <span class='lparen'>(</span><span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=</span> <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span><span class='rparen'>)</span>
        <span class='cvar'>@@last_recv</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
        <span class='cvar'>@@_buffer</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='gvar'>$_SERVERSTRING_</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#TESTING-constant" title="TESTING (constant)">TESTING</a></span></span>
        <span class='kw'>begin</span>
          <span class='gvar'>$cmd_prefix</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>if</span> <span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\034GSw</span><span class='regexp_end'>/</span></span>

          <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span><span class='rparen'>)</span>
            <span class='kw'>unless</span> <span class='const'>Module</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:GameLoader</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>common/game-loader</span><span class='tstring_end'>&#39;</span></span>
              <span class='const'>GameLoader</span><span class='period'>.</span><span class='id identifier rubyid_load!'>load!</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>

          <span class='kw'>if</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^GS</span><span class='regexp_end'>/</span></span>
            <span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clean_gs_serverstring'>clean_gs_serverstring</span><span class='lparen'>(</span><span class='gvar'>$_SERVERSTRING_</span><span class='rparen'>)</span>
          <span class='kw'>else</span>
            <span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clean_dr_serverstring'>clean_dr_serverstring</span><span class='lparen'>(</span><span class='gvar'>$_SERVERSTRING_</span><span class='rparen'>)</span>
          <span class='kw'>end</span>

          <span class='id identifier rubyid_pp'>pp</span> <span class='gvar'>$_SERVERSTRING_</span> <span class='kw'>if</span> <span class='gvar'>$deep_debug</span> <span class='comment'># retain for deep troubleshooting
</span>
          <span class='gvar'>$_SERVERBUFFER_</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='gvar'>$_SERVERSTRING_</span><span class='rparen'>)</span>

          <span class='kw'>if</span> <span class='op'>!</span><span class='cvar'>@@autostarted</span> <span class='kw'>and</span> <span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;app char</span><span class='regexp_end'>/</span></span>
            <span class='kw'>if</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#LICH_VERSION-constant" title="LICH_VERSION (constant)">LICH_VERSION</a></span></span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_core_updated_with_lich_version'><span class='object_link'><a href="../../Lich.html#core_updated_with_lich_version-class_method" title="Lich.core_updated_with_lich_version (method)">core_updated_with_lich_version</a></span></span><span class='rparen'>)</span>
              <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_mono'><span class='object_link'><a href="../Messaging.html#mono-class_method" title="Lich::Messaging.mono (method)">mono</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_monsterbold'><span class='object_link'><a href="../Messaging.html#monsterbold-class_method" title="Lich::Messaging.monsterbold (method)">monsterbold</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>New installation or updated version of Lich5 detected!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
              <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_mono'><span class='object_link'><a href="../Messaging.html#mono-class_method" title="Lich::Messaging.mono (method)">mono</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_monsterbold'><span class='object_link'><a href="../Messaging.html#monsterbold-class_method" title="Lich::Messaging.monsterbold (method)">monsterbold</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Installing newest core scripts available to ensure you&#39;re up-to-date!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
              <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_mono'><span class='object_link'><a href="../Messaging.html#mono-class_method" title="Lich::Messaging.mono (method)">mono</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Util.html" title="Lich::Util (module)">Util</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Util/Update.html" title="Lich::Util::Update (module)">Update</a></span></span><span class='period'>.</span><span class='id identifier rubyid_update_core_data_and_scripts'><span class='object_link'><a href="../Util/Update.html#update_core_data_and_scripts-class_method" title="Lich::Util::Update.update_core_data_and_scripts (method)">update_core_data_and_scripts</a></span></span>
            <span class='kw'>end</span>
            <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>autostart</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>autostart</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
            <span class='cvar'>@@autostarted</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='kw'>if</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>RUBY_VERSION</span><span class='rparen'>)</span> <span class='op'>&lt;</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#RECOMMENDED_RUBY-constant" title="RECOMMENDED_RUBY (constant)">RECOMMENDED_RUBY</a></span></span><span class='rparen'>)</span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span> <span class='op'>=</span> <span class='const'>Terminal</span><span class='op'>::</span><span class='const'>Table</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby Recommended Version Warning</span><span class='tstring_end'>&quot;</span></span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please update your Ruby installation.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;re currently running Ruby v</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>RUBY_VERSION</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>It&#39;s recommended to run Ruby v</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#RECOMMENDED_RUBY-constant" title="RECOMMENDED_RUBY (constant)">RECOMMENDED_RUBY</a></span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> or higher!</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Future Lich5 releases will soon require this newer version.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Visit the following link for info on updating:</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='kw'>if</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^GS</span><span class='regexp_end'>/</span></span>
                <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://gswiki.play.net/Lich:Software/Installation</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='kw'>elsif</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^DR</span><span class='regexp_end'>/</span></span>
                <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://github.com/elanthia-online/lich-5/wiki/Documentation-for-Installing-and-Upgrading-Lich</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='kw'>else</span>
                <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown game type </span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='embexpr_end'>}</span><span class='tstring_content'> detected.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsure of proper documentation, please seek assistance via discord!</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
                <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_mono'><span class='object_link'><a href="../Messaging.html#mono-class_method" title="Lich::Messaging.mono (method)">mono</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_monsterbold'><span class='object_link'><a href="../Messaging.html#monsterbold-class_method" title="Lich::Messaging.monsterbold (method)">monsterbold</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='rparen'>)</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>

          <span class='kw'>if</span> <span class='op'>!</span><span class='cvar'>@@infomon_loaded</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Infomon.html" title="Lich::Gemstone::Infomon (module)">Infomon</a></span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='gvar'>$DRINFOMON_VERSION</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_dialogs'>dialogs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='const'>ExecScript</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Infomon.redo!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>infomon_reset</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^DR</span><span class='regexp_end'>/</span></span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="Infomon.html" title="Lich::Gemstone::Infomon (module)">Infomon</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_refresh_needed?'><span class='object_link'><a href="Infomon.html#db_refresh_needed%3F-class_method" title="Lich::Gemstone::Infomon.db_refresh_needed? (method)">db_refresh_needed?</a></span></span>
            <span class='cvar'>@@infomon_loaded</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='kw'>end</span>

          <span class='kw'>if</span> <span class='op'>!</span><span class='cvar'>@@cli_scripts</span> <span class='op'>&amp;&amp;</span> <span class='cvar'>@@autostarted</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\-\-start\-scripts=</span><span class='regexp_end'>/</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
              <span class='kw'>for</span> <span class='id identifier rubyid_script_name'>script_name</span> <span class='kw'>in</span> <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>--start-scripts=</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_script_name'>script_name</span><span class='rparen'>)</span>
              <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='cvar'>@@cli_scripts</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: logged in as </span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>end</span>
          <span class='kw'>unless</span> <span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&lt;settings </span><span class='regexp_end'>/</span></span>
            <span class='kw'>begin</span>
              <span class='comment'># Check for valid XML prior to sending to client, corrects double and single nested quotes
</span>              <span class='const'>REXML</span><span class='op'>::</span><span class='const'>Document</span><span class='period'>.</span><span class='id identifier rubyid_parse_stream'>parse_stream</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;root&gt;</span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/root&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>XMLData</span><span class='rparen'>)</span>
            <span class='kw'>rescue</span>
              <span class='kw'>unless</span> <span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>invalid byte sequence</span><span class='regexp_end'>/</span></span>
                <span class='comment'># Fixed invalid xml such as:
</span>                <span class='comment'># &lt;mode id=&quot;GAME&quot;/&gt;&lt;settingsInfo  space not found crc=&#39;0&#39; instance=&#39;DR&#39;/&gt;
</span>                <span class='comment'># &lt;settingsInfo  space not found crc=&#39;0&#39; instance=&#39;DR&#39;/&gt;
</span>                <span class='kw'>if</span> <span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;settingsInfo .*?space not found </span><span class='regexp_end'>/</span></span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid settingsInfo XML tags detected: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>space not found</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid settingsInfo XML tags fixed to: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>retry</span>
                <span class='kw'>end</span>
                <span class='comment'># Illegal character &quot;&amp;&quot; in raw string &quot;  You also see a large bin labeled \&quot;Lost &amp; Found\&quot;, a hastily scrawled notice, a brightly painted sign, a silver bell, the Registrar&#39;s Office and &quot;
</span>                <span class='kw'>if</span> <span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\&amp;</span><span class='regexp_end'>/</span></span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid \&amp; detected: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&amp;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;amp;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid \&amp; stripped out: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>retry</span>
                <span class='kw'>end</span>
                <span class='comment'># Illegal character &quot;\a&quot; in raw string &quot;\aYOU HAVE BEEN IDLE TOO LONG. PLEASE RESPOND.\a\n&quot;
</span>                <span class='kw'>if</span> <span class='gvar'>$_SERVERSTRING_</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\a</span><span class='regexp_end'>/</span></span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid \a detected: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid \a stripped out: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>retry</span>
                <span class='kw'>end</span>
                <span class='comment'># Fixes invalid XML with nested single quotes in it such as:
</span>                <span class='comment'># From DR intro tips
</span>                <span class='comment'># &lt;link id=&#39;2&#39; value=&#39;Ever wondered about the time you&#39;ve spent in Elanthia?  Check the PLAYED verb!&#39; cmd=&#39;played&#39; echo=&#39;played&#39; /&gt;
</span>                <span class='comment'># From GS
</span>                <span class='comment'># &lt;d cmd=&#39;forage Imaera&#39;s Lace&#39;&gt;Imaera&#39;s Lace&lt;/d&gt;, &lt;d cmd=&#39;forage stalk burdock&#39;&gt;stalk of burdock&lt;/d&gt;
</span>                <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_matches'>matches</span> <span class='op'>=</span> <span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&#39;([^=&gt;]*&#39;[^=&gt;]*)&#39;</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid nested single quotes XML tags detected: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='id identifier rubyid_matches'>matches</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_match'><span class='object_link'><a href="../../top-level-namespace.html#match-instance_method" title="#match (method)">match</a></span></span><span class='op'>|</span>
                    <span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='id identifier rubyid_match'><span class='object_link'><a href="../../top-level-namespace.html#match-instance_method" title="#match (method)">match</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_match'><span class='object_link'><a href="../../top-level-namespace.html#match-instance_method" title="#match (method)">match</a></span></span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&#39;</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;apos;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
                  <span class='kw'>end</span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid nested single quotes XML tags fixed to: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>retry</span>
                <span class='kw'>end</span>
                <span class='comment'># Fixes invalid XML with nested double quotes in it such as:
</span>                <span class='comment'># &lt;subtitle=&quot; - [Avlea&#39;s Bows, &quot;The Straight and Arrow&quot;]&quot;&gt;
</span>                <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_matches'>matches</span> <span class='op'>=</span> <span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&quot;([^=]*&quot;[^=]*)&quot;</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid nested double quotes XML tags detected: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='id identifier rubyid_matches'>matches</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_match'><span class='object_link'><a href="../../top-level-namespace.html#match-instance_method" title="#match (method)">match</a></span></span><span class='op'>|</span>
                    <span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='id identifier rubyid_match'><span class='object_link'><a href="../../top-level-namespace.html#match-instance_method" title="#match (method)">match</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_match'><span class='object_link'><a href="../../top-level-namespace.html#match-instance_method" title="#match (method)">match</a></span></span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&quot;</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;quot;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
                  <span class='kw'>end</span>
                  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid nested double quotes XML tags fixed to: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>retry</span>
                <span class='kw'>end</span>
                <span class='gvar'>$stdout</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid XML detected - please report this: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
              <span class='kw'>end</span>
              <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
            <span class='kw'>end</span>
            <span class='kw'>if</span> <span class='const'>Module</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:GameLoader</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_infomon_serverstring'>infomon_serverstring</span> <span class='op'>=</span> <span class='gvar'>$_SERVERSTRING_</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
              <span class='kw'>if</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^GS</span><span class='regexp_end'>/</span></span>
                <span class='const'><span class='object_link'><a href="Infomon.html" title="Lich::Gemstone::Infomon (module)">Infomon</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Infomon/XMLParser.html" title="Lich::Gemstone::Infomon::XMLParser (module)">XMLParser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Infomon/XMLParser.html#parse-class_method" title="Lich::Gemstone::Infomon::XMLParser.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_infomon_serverstring'>infomon_serverstring</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_stripped_infomon_serverstring'>stripped_infomon_serverstring</span> <span class='op'>=</span> <span class='id identifier rubyid_strip_xml'><span class='object_link'><a href="../../top-level-namespace.html#strip_xml-instance_method" title="#strip_xml (method)">strip_xml</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_infomon_serverstring'>infomon_serverstring</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>infomon</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                <span class='id identifier rubyid_stripped_infomon_serverstring'>stripped_infomon_serverstring</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
                  <span class='kw'>unless</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
                    <span class='const'><span class='object_link'><a href="Infomon.html" title="Lich::Gemstone::Infomon (module)">Infomon</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Infomon/Parser.html" title="Lich::Gemstone::Infomon::Parser (module)">Parser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Infomon/Parser.html#parse-class_method" title="Lich::Gemstone::Infomon::Parser.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
                  <span class='kw'>end</span>
                <span class='rbrace'>}</span>
              <span class='kw'>elsif</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^DR</span><span class='regexp_end'>/</span></span>
                <span class='const'>DRParser</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_infomon_serverstring'>infomon_serverstring</span><span class='rparen'>)</span>
              <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new_downstream_xml'>new_downstream_xml</span><span class='lparen'>(</span><span class='gvar'>$_SERVERSTRING_</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_stripped_server'>stripped_server</span> <span class='op'>=</span> <span class='id identifier rubyid_strip_xml'><span class='object_link'><a href="../../top-level-namespace.html#strip_xml-instance_method" title="#strip_xml (method)">strip_xml</a></span></span><span class='lparen'>(</span><span class='gvar'>$_SERVERSTRING_</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>main</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
            <span class='id identifier rubyid_stripped_server'>stripped_server</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
              <span class='cvar'>@@buffer</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#TESTING-constant" title="TESTING (constant)">TESTING</a></span></span>
              <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new_downstream'>new_downstream</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='rbrace'>}</span>
          <span class='kw'>end</span>
          <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='const'>DownstreamHook</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='gvar'>$_SERVERSTRING_</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='comment'>#                           Buffer.update(alt_string, Buffer::DOWNSTREAM_MOD)
</span>            <span class='kw'>if</span> <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(?:&lt;resource picture=&quot;\d+&quot;\/&gt;|&lt;popBold\/&gt;)?&lt;style id=&quot;roomName&quot;\s+\/&gt;</span><span class='regexp_end'>/</span></span>
              <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_lichid'><span class='object_link'><a href="../../Lich.html#display_lichid-class_method" title="Lich.display_lichid (method)">display_lichid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_uid'><span class='object_link'><a href="../../Lich.html#display_uid-class_method" title="Lich.display_uid (method)">display_uid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
                <span class='kw'>if</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^GS</span><span class='regexp_end'>/</span></span>
                  <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_lichid'><span class='object_link'><a href="../../Lich.html#display_lichid-class_method" title="Lich.display_lichid (method)">display_lichid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_uid'><span class='object_link'><a href="../../Lich.html#display_uid-class_method" title="Lich.display_uid (method)">display_uid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>] \(\d+\)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>]</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>] (u</span><span class='embexpr_beg'>#{</span><span class='lparen'>(</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_id'>room_id</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>||</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_id'>room_id</span> <span class='op'>&gt;</span> <span class='int'>4294967296</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nknown</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_id'>room_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                  <span class='kw'>elsif</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_lichid'><span class='object_link'><a href="../../Lich.html#display_lichid-class_method" title="Lich.display_lichid (method)">display_lichid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>]</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                  <span class='kw'>elsif</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_uid'><span class='object_link'><a href="../../Lich.html#display_uid-class_method" title="Lich.display_uid (method)">display_uid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>] \(\d+\)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>]</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>] (u</span><span class='embexpr_beg'>#{</span><span class='lparen'>(</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_id'>room_id</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>||</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_id'>room_id</span> <span class='op'>&gt;</span> <span class='int'>4294967296</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nknown</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_id'>room_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                  <span class='kw'>end</span>
                <span class='kw'>elsif</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^DR</span><span class='regexp_end'>/</span></span>
                  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_uid'><span class='object_link'><a href="../../Lich.html#display_uid-class_method" title="Lich.display_uid (method)">display_uid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>] \((?:\d+|\*\*)\)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                  <span class='kw'>elsif</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hide_uid_flag'><span class='object_link'><a href="../../Lich.html#hide_uid_flag-class_method" title="Lich.hide_uid_flag (method)">hide_uid_flag</a></span></span> <span class='op'>==</span> <span class='kw'>true</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>] \((?:\d+|\*\*)\)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
                  <span class='kw'>end</span>
                <span class='kw'>end</span>
              <span class='kw'>end</span>
              <span class='cvar'>@@room_number_after_ready</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='kw'>end</span>
            <span class='kw'>if</span> <span class='gvar'>$frontend</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>genie</span><span class='regexp_end'>/i</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&lt;streamWindow id=&#39;room&#39; title=&#39;Room&#39; subtitle=&quot; - \[.*\] \((?:\d+|\*\*)\)&quot;</span><span class='regexp_end'>/</span></span>
              <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>] \((?:\d+|\*\*)\)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>
            <span class='kw'>if</span> <span class='cvar'>@@room_number_after_ready</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;prompt </span><span class='regexp_end'>/</span></span>
              <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_stringprocs'><span class='object_link'><a href="../../Lich.html#display_stringprocs-class_method" title="Lich.display_stringprocs (method)">display_stringprocs</a></span></span> <span class='op'>==</span> <span class='kw'>true</span>
                <span class='id identifier rubyid_room_exits'>room_exits</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
                <span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_wayto'>wayto</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
                  <span class='comment'># Don&#39;t include cardinals / up/down/out (usually just climb/go)
</span>                  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> <span class='const'>Proc</span>
                    <span class='kw'>if</span> <span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_timeto'>timeto</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Numeric.html" title="Numeric (class)">Numeric</a></span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_timeto'>timeto</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>StringProc</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_timeto'>timeto</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Numeric.html" title="Numeric (class)">Numeric</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
                      <span class='id identifier rubyid_room_exits'>room_exits</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;d cmd=&#39;;go2 </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;&gt;</span><span class='embexpr_beg'>#{</span><span class='const'>Map</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\[|\]</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_lichid'><span class='object_link'><a href="../../Lich.html#display_lichid-class_method" title="Lich.display_lichid (method)">display_lichid</a></span></span> <span class='op'>?</span> <span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='const'>Map</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/d&gt;</span><span class='tstring_end'>&quot;</span></span>
                    <span class='kw'>end</span>
                  <span class='kw'>end</span>
                <span class='kw'>end</span>
                <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StringProcs: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_room_exits'>room_exits</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_room_exits'>room_exits</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
              <span class='kw'>end</span>
              <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_exits'><span class='object_link'><a href="../../Lich.html#display_exits-class_method" title="Lich.display_exits (method)">display_exits</a></span></span> <span class='op'>==</span> <span class='kw'>true</span>
                <span class='id identifier rubyid_room_exits'>room_exits</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
                <span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_wayto'>wayto</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__key'>_key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
                  <span class='comment'># Don&#39;t include cardinals / up/down/out (usually just climb/go)
</span>                  <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(?:o|d|u|n|ne|e|se|s|sw|w|nw|out|down|up|north|northeast|east|southeast|south|southwest|west|northwest)$</span><span class='regexp_end'>/</span></span>
                  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>!=</span> <span class='const'>Proc</span>
                    <span class='id identifier rubyid_room_exits'>room_exits</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;d cmd=&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/d&gt;</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>end</span>
                <span class='kw'>end</span>
                <span class='kw'>unless</span> <span class='id identifier rubyid_room_exits'>room_exits</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
                  <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Room Exits: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_room_exits'>room_exits</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>if</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^GS</span><span class='regexp_end'>/</span></span> <span class='op'>&amp;&amp;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>wrayth</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stormfront</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='gvar'>$frontend</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='cvar'>@@last_id_shown_room_window</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;pushStream id=&#39;room&#39; ifClosedStyle=&#39;watching&#39;/&gt;Room Exits: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_room_exits'>room_exits</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n&lt;popStream/&gt;\r\n</span><span class='tstring_end'>&quot;</span></span>
                    <span class='cvar'>@@last_id_shown_room_window</span> <span class='op'>=</span> <span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
                  <span class='kw'>end</span>
                <span class='kw'>end</span>
              <span class='kw'>end</span>
              <span class='kw'>if</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^DR</span><span class='regexp_end'>/</span></span>
                <span class='id identifier rubyid_room_number'>room_number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_room_number'>room_number</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_lichid'><span class='object_link'><a href="../../Lich.html#display_lichid-class_method" title="Lich.display_lichid (method)">display_lichid</a></span></span>
                <span class='id identifier rubyid_room_number'>room_number</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> - </span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_lichid'><span class='object_link'><a href="../../Lich.html#display_lichid-class_method" title="Lich.display_lichid (method)">display_lichid</a></span></span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_uid'><span class='object_link'><a href="../../Lich.html#display_uid-class_method" title="Lich.display_uid (method)">display_uid</a></span></span>
                <span class='id identifier rubyid_room_number'>room_number</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_id'>room_id</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>**</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>u</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_id'>room_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_uid'><span class='object_link'><a href="../../Lich.html#display_uid-class_method" title="Lich.display_uid (method)">display_uid</a></span></span>
                <span class='kw'>unless</span> <span class='id identifier rubyid_room_number'>room_number</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
                  <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Room Number: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_room_number'>room_number</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>if</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>wrayth</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stormfront</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='gvar'>$frontend</span><span class='rparen'>)</span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;streamWindow id=&#39;main&#39; title=&#39;Story&#39; subtitle=\&quot; - [</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_title'>room_title</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='op'>-</span><span class='int'>3</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_room_number'>room_number</span><span class='embexpr_end'>}</span><span class='tstring_content'>]\&quot; location=&#39;center&#39; target=&#39;drop&#39;/&gt;\r\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                    <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;streamWindow id=&#39;room&#39; title=&#39;Room&#39; subtitle=\&quot; - [</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_room_title'>room_title</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='op'>-</span><span class='int'>3</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_room_number'>room_number</span><span class='embexpr_end'>}</span><span class='tstring_content'>]\&quot; location=&#39;center&#39; target=&#39;drop&#39; ifClosed=&#39;&#39; resident=&#39;true&#39;/&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>end</span>
                <span class='kw'>end</span>
              <span class='kw'>end</span>
              <span class='cvar'>@@room_number_after_ready</span> <span class='op'>=</span> <span class='kw'>false</span>
            <span class='kw'>end</span>
            <span class='kw'>if</span> <span class='gvar'>$frontend</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(?:wizard|avalon)$</span><span class='regexp_end'>/</span></span>
              <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='id identifier rubyid_sf_to_wiz'><span class='object_link'><a href="../../top-level-namespace.html#sf_to_wiz-instance_method" title="#sf_to_wiz (method)">sf_to_wiz</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
            <span class='kw'>if</span> <span class='gvar'>$_DETACHABLE_CLIENT_</span>
              <span class='kw'>begin</span>
                <span class='gvar'>$_DETACHABLE_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
              <span class='kw'>rescue</span>
                <span class='gvar'>$_DETACHABLE_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
                <span class='gvar'>$_DETACHABLE_CLIENT_</span> <span class='op'>=</span> <span class='kw'>nil</span>
                <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--- Lich: error: client_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
                <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: client_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
              <span class='kw'>end</span>
            <span class='kw'>else</span>
              <span class='gvar'>$_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>rescue</span>
          <span class='gvar'>$stdout</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>StandardError</span>
      <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='gvar'>$stdout</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='int'>10</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.2</span>
      <span class='kw'>retry</span> <span class='kw'>unless</span> <span class='gvar'>$_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span> <span class='kw'>or</span> <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>invalid argument|A connection attempt failed|An existing connection was forcibly closed|An established connection was aborted by the software in your host machine.</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span>
    <span class='kw'>rescue</span>
      <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='gvar'>$stdout</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='int'>10</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.2</span>
      <span class='kw'>retry</span> <span class='kw'>unless</span> <span class='gvar'>$_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span> <span class='kw'>or</span> <span class='cvar'>@@socket</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>invalid argument|A connection attempt failed|An existing connection was forcibly closed|An established connection was aborted by the software in your host machine.</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
  <span class='cvar'>@@thread</span><span class='period'>.</span><span class='id identifier rubyid_priority'>priority</span> <span class='op'>=</span> <span class='int'>4</span>
  <span class='gvar'>$_SERVER_</span> <span class='op'>=</span> <span class='cvar'>@@socket</span> <span class='comment'># deprecated
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="puts-class_method">
  
    .<strong>puts</strong>(str)  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sends a formatted string to the game socket and updates the last upstream message.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello, World!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the string to send</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


472
473
474
475
476
477
478
479
480
481
482
483
484
485</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 472</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='gvar'>$_SCRIPTIDLETIMESTAMP_</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_script'>script</span> <span class='op'>=</span> <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_script_name'>script_name</span> <span class='op'>=</span> <span class='id identifier rubyid_script'>script</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_script_name'>script_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(unknown script)</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
  <span class='gvar'>$_CLIENTBUFFER_</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_script_name'>script_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='gvar'>$SEND_CHARACTER</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='gvar'>$cmd_prefix</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_script'>script</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='kw'>not</span> <span class='id identifier rubyid_script'>script</span><span class='period'>.</span><span class='id identifier rubyid_silent'>silent</span>
    <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_script_name'>script_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='gvar'>$SEND_CHARACTER</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid__puts'><span class='object_link'><a href="#_puts-class_method" title="Lich::Gemstone::Game._puts (method)">_puts</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='gvar'>$cmd_prefix</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='gvar'>$_LASTUPSTREAM_</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_script_name'>script_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='gvar'>$SEND_CHARACTER</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="thread-class_method">
  
    .<strong>thread</strong>  &#x21d2; <tt>Thread</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the current thread associated with the Game.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Thread</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the current game thread</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


430
431
432</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/games.rb', line 430</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Game (module)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_thread'>thread</span>
  <span class='cvar'>@@thread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu May 15 06:52:58 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.3.4).
</div>

    </div>
  </body>
</html>