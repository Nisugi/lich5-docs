<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Lich::Common::SharedBuffer
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Lich::Common::SharedBuffer";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span>
     &raquo; 
    <span class="title">SharedBuffer</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Lich::Common::SharedBuffer
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Lich::Common::SharedBuffer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/common/sharedbuffer.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>A thread-safe buffer that allows multiple threads to read and write data.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_size-instance_method" title="#max_size (instance method)">#<strong>max_size</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The maximum size of the buffer.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cleanup_threads-instance_method" title="#cleanup_threads (instance method)">#<strong>cleanup_threads</strong>  &#x21d2; SharedBuffer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Cleans up the buffer by removing entries for threads that no longer exist.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear-instance_method" title="#clear (instance method)">#<strong>clear</strong>  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clears the lines that have been read by the current thread.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gets-instance_method" title="#gets (instance method)">#<strong>gets</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the next line from the buffer, blocking if necessary.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gets%3F-instance_method" title="#gets? (instance method)">#<strong>gets?</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the next line from the buffer without blocking.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(args = {})  &#x21d2; SharedBuffer </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initializes a new SharedBuffer instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rewind-instance_method" title="#rewind (instance method)">#<strong>rewind</strong>  &#x21d2; SharedBuffer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Resets the current threadâ€™s read index to the beginning of the buffer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>(line)  &#x21d2; SharedBuffer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates the buffer with a new line, ensuring the buffer does not exceed max_size.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(args = {})  &#x21d2; <tt><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initializes a new SharedBuffer instance.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>max_size:</span> <span class='int'>1000</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>options for initialization.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>args</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:max_size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>500</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>the maximum size of the buffer.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25
26
27
28</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/common/sharedbuffer.rb', line 21</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@buffer</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@buffer_offset</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@buffer_index</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@buffer_mutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@max_size</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>500</span>
  <span class='comment'># return self # rubocop does not like this - Lint/ReturnInVoidContext
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="max_size=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="max_size-instance_method">
  
    #<strong>max_size</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the maximum size of the buffer.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the maximum size of the buffer.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/common/sharedbuffer.rb', line 11</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:max_size</span>

  <span class='comment'># Initializes a new SharedBuffer instance.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param args [Hash] options for initialization.
</span>  <span class='comment'># @option args [Integer] :max_size (500) the maximum size of the buffer.
</span>  <span class='comment'># @return [SharedBuffer] the instance of SharedBuffer.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   buffer = Lich::Common::SharedBuffer.new(max_size: 1000)
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='ivar'>@buffer</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@buffer_offset</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='ivar'>@buffer_index</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@buffer_mutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@max_size</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>500</span>
    <span class='comment'># return self # rubocop does not like this - Lint/ReturnInVoidContext
</span>  <span class='kw'>end</span>

  <span class='comment'># Retrieves the next line from the buffer, blocking if necessary.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String, nil] the next line from the buffer or nil if no line is available.
</span>  <span class='comment'># @note This method will block until a line is available.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   line = buffer.gets
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_gets'>gets</span>
    <span class='id identifier rubyid_thread_id'>thread_id</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span>
    <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@buffer_offset</span> <span class='op'>+</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.05</span> <span class='kw'>while</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
      <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='ivar'>@buffer_offset</span>
        <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@buffer_offset</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='ivar'>@buffer</span><span class='lbracket'>[</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rbracket'>]</span>
    <span class='rbrace'>}</span>
    <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span>
  <span class='kw'>end</span>

  <span class='comment'># Retrieves the next line from the buffer without blocking.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String, nil] the next line from the buffer or nil if no line is available.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   line = buffer.gets?
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_gets?'>gets?</span>
    <span class='id identifier rubyid_thread_id'>thread_id</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span>
    <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@buffer_offset</span> <span class='op'>+</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
      <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
      <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='ivar'>@buffer_offset</span>
        <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@buffer_offset</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='ivar'>@buffer</span><span class='lbracket'>[</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rbracket'>]</span>
    <span class='rbrace'>}</span>
    <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span>
  <span class='kw'>end</span>

  <span class='comment'># Clears the lines that have been read by the current thread.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Array&lt;String&gt;] an array of lines that were cleared.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   cleared_lines = buffer.clear
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_clear'><span class='object_link'><a href="../../top-level-namespace.html#clear-instance_method" title="#clear (method)">clear</a></span></span>
    <span class='id identifier rubyid_thread_id'>thread_id</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span>
    <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@buffer_offset</span> <span class='op'>+</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>return</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
      <span class='kw'>return</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
      <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='ivar'>@buffer_offset</span>
        <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@buffer_offset</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='ivar'>@buffer</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@buffer_offset</span> <span class='op'>+</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_lines'>lines</span>
  <span class='kw'>end</span>

  <span class='comment'># Resets the current thread&#39;s read index to the beginning of the buffer.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [SharedBuffer] the instance of SharedBuffer.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   buffer.rewind
</span>  <span class='comment'>#   line = buffer.gets
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_rewind'>rewind</span>
    <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@buffer_offset</span>
    <span class='kw'>return</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Updates the buffer with a new line, ensuring the buffer does not exceed max_size.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param line [String] the line to be added to the buffer.
</span>  <span class='comment'># @return [SharedBuffer] the instance of SharedBuffer.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   buffer.update(&quot;New line of text&quot;)
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
    <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_fline'>fline</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
      <span class='id identifier rubyid_fline'>fline</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
      <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_fline'>fline</span><span class='rparen'>)</span>
      <span class='kw'>while</span> <span class='lparen'>(</span><span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='ivar'>@max_size</span><span class='rparen'>)</span>
        <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
        <span class='ivar'>@buffer_offset</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Cleans up the buffer by removing entries for threads that no longer exist.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [SharedBuffer] the instance of SharedBuffer.
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   buffer.cleanup_threads
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_cleanup_threads'>cleanup_threads</span>
    <span class='ivar'>@buffer_index</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid__v'>_v</span><span class='op'>|</span> <span class='kw'>not</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_k'>k</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="cleanup_threads-instance_method">
  
    #<strong>cleanup_threads</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Cleans up the buffer by removing entries for threads that no longer exist.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_buffer'>buffer</span><span class='period'>.</span><span class='id identifier rubyid_cleanup_threads'>cleanup_threads</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the instance of SharedBuffer.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


141
142
143
144</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/common/sharedbuffer.rb', line 141</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup_threads'>cleanup_threads</span>
  <span class='ivar'>@buffer_index</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid__v'>_v</span><span class='op'>|</span> <span class='kw'>not</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_k'>k</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clear-instance_method">
  
    #<strong>clear</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clears the lines that have been read by the current thread.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_cleared_lines'>cleared_lines</span> <span class='op'>=</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an array of lines that were cleared.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/common/sharedbuffer.rb', line 85</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear'><span class='object_link'><a href="../../top-level-namespace.html#clear-instance_method" title="#clear (method)">clear</a></span></span>
  <span class='id identifier rubyid_thread_id'>thread_id</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span>
  <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@buffer_offset</span> <span class='op'>+</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='kw'>return</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
    <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='ivar'>@buffer_offset</span>
      <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@buffer_offset</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='ivar'>@buffer</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@buffer_offset</span> <span class='op'>+</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_lines'>lines</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="gets-instance_method">
  
    #<strong>gets</strong>  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method will block until a line is available.</p>
</div>
  </div>


<p>Retrieves the next line from the buffer, blocking if necessary.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the next line from the buffer or nil if no line is available.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/common/sharedbuffer.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gets'>gets</span>
  <span class='id identifier rubyid_thread_id'>thread_id</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span>
  <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@buffer_offset</span> <span class='op'>+</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.05</span> <span class='kw'>while</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
    <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='ivar'>@buffer_offset</span>
      <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@buffer_offset</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='ivar'>@buffer</span><span class='lbracket'>[</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="gets?-instance_method">
  
    #<strong>gets?</strong>  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves the next line from the buffer without blocking.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='period'>.</span><span class='id identifier rubyid_gets?'>gets?</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the next line from the buffer or nil if no line is available.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/common/sharedbuffer.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gets?'>gets?</span>
  <span class='id identifier rubyid_thread_id'>thread_id</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span>
  <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@buffer_offset</span> <span class='op'>+</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
    <span class='kw'>if</span> <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='ivar'>@buffer_offset</span>
      <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@buffer_offset</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='ivar'>@buffer</span><span class='lbracket'>[</span><span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='ivar'>@buffer_offset</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread_id'>thread_id</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rewind-instance_method">
  
    #<strong>rewind</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Resets the current threadâ€™s read index to the beginning of the buffer.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_buffer'>buffer</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
<span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_buffer'>buffer</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the instance of SharedBuffer.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/common/sharedbuffer.rb', line 112</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rewind'>rewind</span>
  <span class='ivar'>@buffer_index</span><span class='lbracket'>[</span><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@buffer_offset</span>
  <span class='kw'>return</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    #<strong>update</strong>(line)  &#x21d2; <tt><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates the buffer with a new line, ensuring the buffer does not exceed max_size.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_buffer'>buffer</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>New line of text</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>line</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the line to be added to the buffer.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the instance of SharedBuffer.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129
130
131
132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/common/sharedbuffer.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='ivar'>@buffer_mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_fline'>fline</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_fline'>fline</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
    <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_fline'>fline</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='lparen'>(</span><span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='ivar'>@max_size</span><span class='rparen'>)</span>
      <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
      <span class='ivar'>@buffer_offset</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu May 15 06:53:05 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.3.4).
</div>

    </div>
  </body>
</html>